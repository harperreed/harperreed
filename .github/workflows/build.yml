name: Build README

on:
    push:
    workflow_dispatch:
    schedule:
        - cron: "32 0 * * *"

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Check out repo
              uses: actions/checkout@v4

            - name: Install uv
              uses: astral-sh/setup-uv@v5
              with:
                  version: "latest"

            - name: Set up Python
              run: uv python install 3.12

            - name: Install dependencies
              run: uv sync --frozen

            - name: Update README
              env:
                  GH_TOKEN: ${{ github.token }}
              run: |
                  uv run python -m readme_builder.main
                  cat README.md

            - name: Commit and push if changed
              run: |
                  git diff
                  git config --global user.email "harper+readme-bot@modest.com"
                  git config --global user.name "README-bot"
                  git add -A
                  git commit -m "Updated content" || exit 0
                  git push
